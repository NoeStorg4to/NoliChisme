<div class="publicaciones-container">
  <div class="publicaciones-header">
    <div class="mascota-welcome">
      <h1>Últimos Chismes</h1>
      <img 
        src="imagenes/Noli-chismosa2.png" 
        alt="Mascota NoliChismes" 
        class="mascota-img">
    </div>
    
    <div class="sort-controls">
      <button class="btn btn-primary btn-crear" (click)="isModalOpen = true">
        + Crear Chisme
      </button>
      <span>Ordenar por:</span>
      <button 
        class="btn-sort" 
        [class.active]="sortBy === 'fechaCreacion'"
        (click)="onSortChange('fechaCreacion')">
        Recientes
      </button>
      <button 
        class="btn-sort"
        [class.active]="sortBy === 'meGusta'"
        (click)="onSortChange('meGusta')">
        Más Populares
      </button>
    </div>
  </div>

  @if (isLoading && publicaciones.length === 0) {
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Cargando chismecitos...</p>
    </div>
  }

  @if (errorMessage) {
    <div class="alert alert-danger">{{ errorMessage }}</div>
  }

  <div class="publicaciones-list">
    @for (pub of publicaciones; track pub._id) {
      <app-publicacion-card
        [publicacion]="pub" 
        [currentUser]="currentUser"
        (onLikeToggle)="handleLikeToggle($event)"
        (deleteRequest)="onDeleteRequest($event)">
      </app-publicacion-card>
    }
  </div>

  @if (isModalOpen) {
    <app-create-publicacion-modal 
      (close)="isModalOpen = false"
      (publicacionCreada)="addNewPublicacion($event)">
    </app-create-publicacion-modal>
  }

  @if (publicacionAEliminar) {
    <app-confirm-modal
      [message]="'Seguro que quieres eliminar este chisme? No se puede deshacer.'"
      confirmButtonText="Sí, eliminar"
      [danger]="true"
      (onConfirm)="onConfirmDelete()"
      (onClose)="onCancelDelete()">
    </app-confirm-modal>
  }

  @if (!isLoading && publicaciones.length > 0) {
    <app-paginacion
      [paginaActual]="paginaActual"
      [totalPaginas]="totalPaginas"
      (paginaCambiada)="onPaginaCambiada($event)">
    </app-paginacion>
  }

  @if (!isLoading && publicaciones.length === totalPublicaciones && publicaciones.length > 0) {
    <p class="end-of-list">Fin de los chismes por ahora... ¡vuelve más tarde!</p>
  }

  @if (!isLoading && publicaciones.length === 0 && !errorMessage) {
    <p class="end-of-list">No hay chismes para mostrar. ¡Sé el primero!</p>
  }

</div>